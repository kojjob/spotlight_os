<div class="deal-room-container" data-controller="deal-rooms" data-deal-rooms-deal-room-id-value="<%= deal_room.id %>" data-deal-rooms-refresh-interval-value="30000">
  <div class="deal-room-header">
    <div class="flex justify-between items-start mb-6">
      <div>
        <h2 class="text-2xl font-bold mb-2"><%= deal_room.name %></h2>
        <div class="deal-room-meta flex items-center space-x-4">
          <span class="stage-badge px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
            <%= deal_room.stage.humanize %>
          </span>
          <span class="last-updated text-sm text-gray-500">
            Last updated: <%= deal_room.updated_at.strftime("%B %d, %Y") %>
          </span>
        </div>
      </div>
      
      <div class="flex space-x-2">
        <button data-action="click->deal-rooms#refresh" 
                class="px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
        </button>
        <button data-action="click->deal-rooms#toggleAutoRefresh" 
                class="px-3 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors">
          Auto-refresh
        </button>
      </div>
    </div>

    <!-- Stage Progress Indicator -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
      <h3 class="text-sm font-medium text-gray-700 mb-3">Deal Progress</h3>
      <div class="flex items-center space-x-2" data-deal-rooms-target="stageIndicator"></div>
      <div class="mt-3" data-deal-rooms-target="progressBar"></div>
    </div>
  </div>

  <div class="deal-room-content grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2">
      <!-- Deal Summary -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h3 class="text-lg font-semibold mb-4">Deal Summary</h3>
        <div data-deal-rooms-target="summary"></div>
      </div>

      <!-- Interactive Timeline -->
      <%= render 'dashboard/interactive_timeline', deal_room: deal_room %>
      
      <!-- Traditional Timeline Fallback -->
      <div class="bg-white rounded-lg shadow p-6 mt-6">
        <h3 class="text-lg font-semibold mb-4">Timeline Events</h3>
        <div data-deal-rooms-target="timeline"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- AI Summary -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">AI Summary</h3>
        
        <div class="mb-4">
          <h4 class="font-medium mb-2 text-gray-700">Key Points</h4>
          <ul class="list-disc list-inside text-sm space-y-1" data-deal-rooms-target="keyPoints"></ul>
        </div>
        
        <div class="mb-4">
          <h4 class="font-medium mb-2 text-gray-700">Next Steps</h4>
          <ul class="list-disc list-inside text-sm space-y-1" data-deal-rooms-target="nextSteps"></ul>
        </div>
        
        <div>
          <h4 class="font-medium mb-2 text-gray-700">Risk Assessment</h4>
          <div class="text-sm" data-deal-rooms-target="riskAssessment"></div>
        </div>
      </div>

      <!-- Deal Metrics -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Deal Metrics</h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Deal Value</span>
            <span class="font-medium"><%= number_to_currency(deal_room.value || 0) %></span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Probability</span>
            <span class="font-medium"><%= deal_room.probability || 50 %>%</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Days Active</span>
            <span class="font-medium"><%= (Date.current - deal_room.created_at.to_date).to_i %></span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm text-gray-600">Expected Close</span>
            <span class="font-medium"><%= deal_room.expected_close_date&.strftime("%m/%d/%Y") || "TBD" %></span>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
        <div class="space-y-2">
          <button class="w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors text-sm">
            Update Stage
          </button>
          <button class="w-full bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors text-sm">
            Add Note
          </button>
          <button class="w-full bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600 transition-colors text-sm">
            Schedule Follow-up
          </button>
          <button class="w-full bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors text-sm">
            Generate Report
          </button>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
        <div class="space-y-3 text-sm">
          <div class="flex items-start space-x-2">
            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
            <div>
              <p class="text-gray-800">Stage updated to <%= deal_room.stage.humanize %></p>
              <p class="text-gray-500 text-xs"><%= time_ago_in_words(deal_room.updated_at) %> ago</p>
            </div>
          </div>
          <div class="flex items-start space-x-2">
            <div class="w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
            <div>
              <p class="text-gray-800">Deal room created</p>
              <p class="text-gray-500 text-xs"><%= time_ago_in_words(deal_room.created_at) %> ago</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>